#! /bin/bash

which docker >/dev/null
[ $? -eq 0 ] || (echo 'Docker must be installed' && exit 1)

CONTAINER_DIR=/app
COMPOSER_IMAGE=composer/composer

function show_help() {
    cat <<EOF
Usage: docker-composer options [args..]
Running Composer in a Docker container.

Arguments:
  The arguments for composer

Options:
  -d working_dir   If specified, use the given directory as working directory.
  -h               Display this help message
EOF
}

function get_absolute_path() {
    path=$1
    echo $(pushd $1 >/dev/null && pwd && popd >/dev/null)
}

while getopts :d: option
do
    case "$option" in
        d)
            working_dir=$OPTARG
            ;;
        h)
            show_help
            exit 0
            ;;
        \?)
            show_help
            exit 1
            ;;
        :)
            echo "Option $OPTARG requires an argument."
            exit 1
            ;;
    esac
done

shift $((OPTIND-1))

if [ "$working_dir" = "" ]; then
    working_dir=$(pwd)
fi

if [ ! -d $working_dir ]; then
    echo "Invalid working directory specified, $working_dir does not exist."
    exit 1
fi

working_dir=$(get_absolute_path $working_dir)
docker run -v $working_dir:$CONTAINER_DIR $COMPOSER_IMAGE $@
